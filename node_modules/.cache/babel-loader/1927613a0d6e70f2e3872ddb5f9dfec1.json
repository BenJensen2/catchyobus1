{"ast":null,"code":"import _slicedToArray from\"/Users/montyj/Documents/projects/catchyobus/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import axios from'axios';import{Button,Form,Input,Label,FormGroup,Col}from'reactstrap';import\"../components/GetData.css\";import{navigate}from'@reach/router';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var cron=require('node-cron');export default function GetRoutes(){var initialValue=\" \";var _useState=useState([]),_useState2=_slicedToArray(_useState,2),routes=_useState2[0],setRoutes=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),routeName=_useState4[0],setRouteName=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),direction=_useState6[0],setDirection=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),destination=_useState8[0],setDestination=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),stops=_useState10[0],setStops=_useState10[1];var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),stopId=_useState12[0],setStopId=_useState12[1];var _useState13=useState(initialValue),_useState14=_slicedToArray(_useState13,2),phoneNumber=_useState14[0],setPhoneNumber=_useState14[1];var prediction;var busTask;useEffect(function(){axios.get('https://api.actransit.org/transit/routes/?token=A6B7D2FAF537BF5AC5B44DEF8C215F7E').then(function(res){setRoutes(res.data);});},[]);var whatRoute=function whatRoute(e){e.preventDefault();setRouteName(e.target.value);};var whatDirection=function whatDirection(e){e.preventDefault();setDestination(e.target.value);};var whatStop=function whatStop(e){e.preventDefault();setStopId(e.target.value);};var saveThis=function saveThis(e){e.preventDefault();axios.get(\"https://api.actransit.org/transit/route/\".concat(routeName,\"/destinations/?token=A6B7D2FAF537BF5AC5B44DEF8C215F7E\")).then(function(res){setDirection(res.data);});};var saveThat=function saveThat(e){e.preventDefault();axios.get(\"https://api.actransit.org/transit/actrealtime/stop?rt=\".concat(routeName,\"&dir=\").concat(destination,\"&token=A6B7D2FAF537BF5AC5B44DEF8C215F7E\")).then(function(res){var data=res.data[\"bustime-response\"].stops;var loopData=[\"<option>Pick Stop</option>\"];var i=0;while(i<data.length){loopData+=\"<option value=\\\"\".concat(data[i].stpid,\"\\\">\").concat(data[i].stpnm,\"</option>\");i++;}setStops(loopData);});};var saveAlso=function saveAlso(e){e.preventDefault();busTask=cron.schedule('*/5 * * * *',function(){axios.get(\"https://api.actransit.org/transit/actrealtime/prediction?&stpid=\".concat(stopId,\"&rt=\").concat(routeName,\"&top=1&tmres=m&token=A6B7D2FAF537BF5AC5B44DEF8C215F7E\")).then(function(res){prediction=res.data[\"bustime-response\"].prd[0].prdctdn;catchBus();});});navigate(\"/letsgo\");};var message;function catchBus(){if(prediction<10&&prediction>=5){message=\"Your bus is \".concat(prediction,\" minutes away. Get to the bus stop!\");axios.post(\"/send-text?phoneNumber=\".concat(phoneNumber,\"&message=\").concat(message));console.log(message);busTask.stop();}else if(prediction<5){message=\"Your bus is \".concat(prediction,\" minutes away. You might have to wait for the next one.\");axios.post(\"/send-text?phoneNumber=\".concat(phoneNumber,\"&message=\").concat(message));console.log(message);}else{message=\"Chill out! There are \".concat(prediction,\" minutes until your bus comes.\");console.log(message);}}return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(Form,{onSubmit:saveThis,children:[/*#__PURE__*/_jsx(Label,{className:\"purple\",children:\"Pick and submit a route\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(FormGroup,{row:true,children:[/*#__PURE__*/_jsx(Col,{sm:10,children:/*#__PURE__*/_jsxs(Input,{type:\"select\",className:\"form-select\",onChange:whatRoute,children:[/*#__PURE__*/_jsx(\"option\",{children:\"Pick route\"}),routes.map(function(route,index){return/*#__PURE__*/_jsx(\"option\",{children:route.Name},index);}),\";\"]})}),/*#__PURE__*/_jsx(Button,{color:\"primary\",children:\"Submit\"})]})]}),/*#__PURE__*/_jsxs(Form,{onSubmit:saveThat,children:[/*#__PURE__*/_jsx(Label,{children:\"Pick and submit a direction\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(FormGroup,{row:true,children:[/*#__PURE__*/_jsx(Col,{sm:10,children:/*#__PURE__*/_jsxs(Input,{type:\"select\",onChange:whatDirection,children:[/*#__PURE__*/_jsx(\"option\",{children:\"Pick Direction\"}),direction.map(function(direction,index){return/*#__PURE__*/_jsx(\"option\",{children:direction.Destination},index);}),\";\"]})}),/*#__PURE__*/_jsx(Button,{color:\"primary\",children:\"Submit\"})]})]}),/*#__PURE__*/_jsxs(Form,{onSubmit:saveAlso,children:[/*#__PURE__*/_jsx(Label,{children:\"Pick your Stop, then...\"}),/*#__PURE__*/_jsx(FormGroup,{row:true,children:/*#__PURE__*/_jsx(Col,{sm:10,children:/*#__PURE__*/_jsx(Input,{type:\"select\",dangerouslySetInnerHTML:{__html:stops},onChange:whatStop})})}),/*#__PURE__*/_jsx(Label,{children:\"What's your number?\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(FormGroup,{row:true,children:[/*#__PURE__*/_jsx(Col,{sm:10,children:/*#__PURE__*/_jsx(Input,{className:\"form-control\",onChange:function onChange(e){return setPhoneNumber(e.target.value);},value:phoneNumber})}),/*#__PURE__*/_jsx(Input,{type:\"hidden\",value:message}),/*#__PURE__*/_jsx(Button,{color:\"primary\",children:\"Submit\"})]})]})]})});};","map":{"version":3,"sources":["/Users/montyj/Documents/projects/catchyobus/src/components/GetData.js"],"names":["React","useEffect","useState","axios","Button","Form","Input","Label","FormGroup","Col","navigate","cron","require","GetRoutes","initialValue","routes","setRoutes","routeName","setRouteName","direction","setDirection","destination","setDestination","stops","setStops","stopId","setStopId","phoneNumber","setPhoneNumber","prediction","busTask","get","then","res","data","whatRoute","e","preventDefault","target","value","whatDirection","whatStop","saveThis","saveThat","loopData","i","length","stpid","stpnm","saveAlso","schedule","prd","prdctdn","catchBus","message","post","console","log","stop","map","route","index","Name","Destination","__html"],"mappings":"kKAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAASC,MAAT,CAAiBC,IAAjB,CAAuBC,KAAvB,CAA8BC,KAA9B,CAAqCC,SAArC,CAAgDC,GAAhD,KAA4D,YAA5D,CACA,MAAO,2BAAP,CACA,OAASC,QAAT,KAAyB,eAAzB,C,wFAEA,GAAIC,CAAAA,IAAI,CAAGC,OAAO,CAAC,WAAD,CAAlB,CAGA,cAAe,SAASC,CAAAA,SAAT,EAAsB,CACjC,GAAIC,CAAAA,YAAY,CAAG,GAAnB,CADiC,cAGLZ,QAAQ,CAAC,EAAD,CAHH,wCAG1Ba,MAH0B,eAGlBC,SAHkB,8BAICd,QAAQ,EAJT,yCAI1Be,SAJ0B,eAIfC,YAJe,8BAKChB,QAAQ,CAAC,EAAD,CALT,yCAK1BiB,SAL0B,eAKfC,YALe,8BAMKlB,QAAQ,EANb,yCAM1BmB,WAN0B,eAMbC,cANa,8BAOPpB,QAAQ,EAPD,0CAO1BqB,KAP0B,gBAOnBC,QAPmB,gCAQLtB,QAAQ,EARH,2CAQ1BuB,MAR0B,gBAQlBC,SARkB,gCASKxB,QAAQ,CAACY,YAAD,CATb,2CAS1Ba,WAT0B,gBASbC,cATa,gBAWjC,GAAIC,CAAAA,UAAJ,CAEA,GAAIC,CAAAA,OAAJ,CAKA7B,SAAS,CAAC,UAAM,CACZE,KAAK,CAAC4B,GAAN,CAAU,kFAAV,EACKC,IADL,CACU,SAAAC,GAAG,CAAI,CACTjB,SAAS,CAACiB,GAAG,CAACC,IAAL,CAAT,CACH,CAHL,EAIH,CALQ,CAKN,EALM,CAAT,CAOA,GAAMC,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,CAAAC,CAAC,CAAI,CACnBA,CAAC,CAACC,cAAF,GACAnB,YAAY,CAACkB,CAAC,CAACE,MAAF,CAASC,KAAV,CAAZ,CACH,CAHD,CAMA,GAAMC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAAAJ,CAAC,CAAI,CACvBA,CAAC,CAACC,cAAF,GACAf,cAAc,CAACc,CAAC,CAACE,MAAF,CAASC,KAAV,CAAd,CACH,CAHD,CAKA,GAAME,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAAAL,CAAC,CAAI,CAClBA,CAAC,CAACC,cAAF,GACAX,SAAS,CAACU,CAAC,CAACE,MAAF,CAASC,KAAV,CAAT,CACH,CAHD,CAKA,GAAMG,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAAAN,CAAC,CAAI,CAClBA,CAAC,CAACC,cAAF,GAEAlC,KAAK,CAAC4B,GAAN,mDAAqDd,SAArD,2DACKe,IADL,CACU,SAAAC,GAAG,CAAI,CACTb,YAAY,CAACa,GAAG,CAACC,IAAL,CAAZ,CACH,CAHL,EAIH,CAPD,CASA,GAAMS,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAAAP,CAAC,CAAI,CAClBA,CAAC,CAACC,cAAF,GAEAlC,KAAK,CAAC4B,GAAN,iEAAmEd,SAAnE,iBAAoFI,WAApF,6CACCW,IADD,CACM,SAAAC,GAAG,CAAI,CACT,GAAIC,CAAAA,IAAI,CAAGD,GAAG,CAACC,IAAJ,CAAS,kBAAT,EAA6BX,KAAxC,CACA,GAAIqB,CAAAA,QAAQ,CAAG,CAAC,4BAAD,CAAf,CACA,GAAIC,CAAAA,CAAC,CAAG,CAAR,CACA,MAAMA,CAAC,CAAGX,IAAI,CAACY,MAAf,CAAsB,CAClBF,QAAQ,4BAAsBV,IAAI,CAACW,CAAD,CAAJ,CAAQE,KAA9B,eAAwCb,IAAI,CAACW,CAAD,CAAJ,CAAQG,KAAhD,aAAR,CACAH,CAAC,GACJ,CACDrB,QAAQ,CAACoB,QAAD,CAAR,CACH,CAVD,EAWH,CAdD,CAiBA,GAAMK,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAAAb,CAAC,CAAI,CAClBA,CAAC,CAACC,cAAF,GAEAP,OAAO,CAAGnB,IAAI,CAACuC,QAAL,CAAc,aAAd,CAA6B,UAAM,CAC7C/C,KAAK,CAAC4B,GAAN,2EAA6EN,MAA7E,gBAA0FR,SAA1F,2DACKe,IADL,CACU,SAAAC,GAAG,CAAI,CACTJ,UAAU,CAAII,GAAG,CAACC,IAAJ,CAAS,kBAAT,EAA6BiB,GAA7B,CAAiC,CAAjC,EAAoCC,OAAlD,CACIC,QAAQ,GACX,CAJT,EAKK,CANK,CAAV,CAQI3C,QAAQ,CAAC,SAAD,CAAR,CACP,CAZD,CAcA,GAAI4C,CAAAA,OAAJ,CAEA,QAASD,CAAAA,QAAT,EAAoB,CAEZ,GAAGxB,UAAU,CAAG,EAAb,EAAmBA,UAAU,EAAI,CAApC,CAAuC,CAEnCyB,OAAO,uBAAkBzB,UAAlB,uCAAP,CAEA1B,KAAK,CAACoD,IAAN,kCAAqC5B,WAArC,qBAA4D2B,OAA5D,GACAE,OAAO,CAACC,GAAR,CAAYH,OAAZ,EACAxB,OAAO,CAAC4B,IAAR,GAEH,CARD,IAQO,IAAG7B,UAAU,CAAG,CAAhB,CAAmB,CACtByB,OAAO,uBAAkBzB,UAAlB,2DAAP,CAEA1B,KAAK,CAACoD,IAAN,kCAAqC5B,WAArC,qBAA4D2B,OAA5D,GACAE,OAAO,CAACC,GAAR,CAAYH,OAAZ,EACH,CALM,IAKA,CACHA,OAAO,gCAA2BzB,UAA3B,kCAAP,CACA2B,OAAO,CAACC,GAAR,CAAYH,OAAZ,EACH,CAER,CAGD,mBACI,kCACI,aAAK,SAAS,CAAC,WAAf,wBACI,MAAC,IAAD,EAAM,QAAQ,CAAEZ,QAAhB,wBACI,KAAC,KAAD,EAAO,SAAS,CAAC,QAAjB,qCADJ,cAEI,aAFJ,cAGI,MAAC,SAAD,EAAW,GAAG,KAAd,wBACA,KAAC,GAAD,EAAK,EAAE,CAAE,EAAT,uBACA,MAAC,KAAD,EAAO,IAAI,CAAC,QAAZ,CAAqB,SAAS,CAAC,aAA/B,CAA6C,QAAQ,CAAEP,SAAvD,wBACI,sCADJ,CAEKpB,MAAM,CAAC4C,GAAP,CAAW,SAACC,KAAD,CAAQC,KAAR,CAAkB,CAC1B,mBAAO,wBACFD,KAAK,CAACE,IADJ,EAAaD,KAAb,CAAP,CAEH,CAHA,CAFL,OADA,EADA,cAUA,KAAC,MAAD,EAAQ,KAAK,CAAC,SAAd,oBAVA,GAHJ,GADJ,cAiBI,MAAC,IAAD,EAAM,QAAQ,CAAElB,QAAhB,wBAEI,KAAC,KAAD,0CAFJ,cAGI,aAHJ,cAII,MAAC,SAAD,EAAW,GAAG,KAAd,wBACA,KAAC,GAAD,EAAK,EAAE,CAAE,EAAT,uBACA,MAAC,KAAD,EAAO,IAAI,CAAC,QAAZ,CAAqB,QAAQ,CAAEH,aAA/B,wBACI,0CADJ,CAEKrB,SAAS,CAACwC,GAAV,CAAc,SAACxC,SAAD,CAAY0C,KAAZ,CAAsB,CACjC,mBAAO,wBACF1C,SAAS,CAAC4C,WADR,EAAaF,KAAb,CAAP,CAEH,CAHA,CAFL,OADA,EADA,cAUA,KAAC,MAAD,EAAQ,KAAK,CAAC,SAAd,oBAVA,GAJJ,GAjBJ,cAkCI,MAAC,IAAD,EAAM,QAAQ,CAAEZ,QAAhB,wBACI,KAAC,KAAD,sCADJ,cAEI,KAAC,SAAD,EAAW,GAAG,KAAd,uBACA,KAAC,GAAD,EAAK,EAAE,CAAE,EAAT,uBACA,KAAC,KAAD,EAAO,IAAI,CAAC,QAAZ,CAAqB,uBAAuB,CAAE,CAACe,MAAM,CAAEzC,KAAT,CAA9C,CAA+D,QAAQ,CAAEkB,QAAzE,EADA,EADA,EAFJ,cAQI,KAAC,KAAD,kCARJ,cAQsC,aARtC,cASI,MAAC,SAAD,EAAW,GAAG,KAAd,wBACA,KAAC,GAAD,EAAK,EAAE,CAAE,EAAT,uBACA,KAAC,KAAD,EAAO,SAAS,CAAC,cAAjB,CAAgC,QAAQ,CAAE,kBAACL,CAAD,QAAOR,CAAAA,cAAc,CAACQ,CAAC,CAACE,MAAF,CAASC,KAAV,CAArB,EAA1C,CAAiF,KAAK,CAAEZ,WAAxF,EADA,EADA,cAIA,KAAC,KAAD,EAAO,IAAI,CAAC,QAAZ,CAAqB,KAAK,CAAE2B,OAA5B,EAJA,cAKA,KAAC,MAAD,EAAQ,KAAK,CAAC,SAAd,oBALA,GATJ,GAlCJ,GADJ,EADJ,CAwDH","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport axios from 'axios';\nimport { Button, Form, Input, Label, FormGroup, Col } from  'reactstrap';\nimport \"../components/GetData.css\";\nimport { navigate } from '@reach/router';\n\nvar cron = require('node-cron');\n\n\nexport default function GetRoutes () {\n    let initialValue = \" \";\n\n    const [routes, setRoutes] = useState([]);\n    const [routeName, setRouteName] = useState(); \n    const [direction, setDirection] = useState([]);\n    const [destination, setDestination] = useState();\n    const [stops, setStops] = useState();\n    const [stopId, setStopId] = useState();\n    const [phoneNumber, setPhoneNumber] = useState(initialValue);\n\n    let prediction;\n\n    let busTask;\n\n\n\n\n    useEffect(() => {\n        axios.get('https://api.actransit.org/transit/routes/?token=A6B7D2FAF537BF5AC5B44DEF8C215F7E')\n            .then(res => {\n                setRoutes(res.data);\n            });\n    }, []);\n\n    const whatRoute = e => {\n        e.preventDefault();\n        setRouteName(e.target.value);\n    };\n\n\n    const whatDirection = e => {\n        e.preventDefault();\n        setDestination(e.target.value);\n    };\n\n    const whatStop = e => {\n        e.preventDefault();\n        setStopId(e.target.value);\n    };\n\n    const saveThis = e => {\n        e.preventDefault();\n        \n        axios.get(`https://api.actransit.org/transit/route/${routeName}/destinations/?token=A6B7D2FAF537BF5AC5B44DEF8C215F7E`)\n            .then(res => {\n                setDirection(res.data);\n            });\n    };\n\n    const saveThat = e => {\n        e.preventDefault();\n        \n        axios.get(`https://api.actransit.org/transit/actrealtime/stop?rt=${routeName}&dir=${destination}&token=A6B7D2FAF537BF5AC5B44DEF8C215F7E`)\n        .then(res => {\n            var data = res.data[\"bustime-response\"].stops;\n            var loopData = [\"<option>Pick Stop</option>\"];\n            var i = 0;\n            while(i < data.length){\n                loopData += `<option value=\"${data[i].stpid}\">${data[i].stpnm}</option>`;\n                i++;\n            }\n            setStops(loopData);\n        });\n    };\n\n\n    const saveAlso = e => {\n        e.preventDefault();\n        \n        busTask = cron.schedule('*/5 * * * *', () => {\n        axios.get(`https://api.actransit.org/transit/actrealtime/prediction?&stpid=${stopId}&rt=${routeName}&top=1&tmres=m&token=A6B7D2FAF537BF5AC5B44DEF8C215F7E`)\n            .then(res => {\n                prediction = (res.data[\"bustime-response\"].prd[0].prdctdn);\n                    catchBus();\n                });\n            });\n\n            navigate(\"/letsgo\");\n    };\n\n    var message;\n\n    function catchBus() {\n\n            if(prediction < 10 && prediction >= 5) {\n            \n                message = `Your bus is ${prediction} minutes away. Get to the bus stop!`;\n    \n                axios.post(`/send-text?phoneNumber=${phoneNumber}&message=${message}`)\n                console.log(message);\n                busTask.stop();\n    \n            } else if(prediction < 5) {\n                message = `Your bus is ${prediction} minutes away. You might have to wait for the next one.`;\n\n                axios.post(`/send-text?phoneNumber=${phoneNumber}&message=${message}`);\n                console.log(message);\n            } else {\n                message = `Chill out! There are ${prediction} minutes until your bus comes.`;\n                console.log(message);\n            }\n        \n    }\n\n\n    return (\n        <div>\n            <div className=\"container\">\n                <Form onSubmit={saveThis}>\n                    <Label className=\"purple\">Pick and submit a route</Label>\n                    <br />\n                    <FormGroup row>\n                    <Col sm={10}>\n                    <Input type=\"select\" className=\"form-select\" onChange={whatRoute}>\n                        <option>Pick route</option>\n                        {routes.map((route, index) => {\n                            return <option key={index}>\n                                {route.Name}</option>\n                        })};\n                    </Input>\n                    </Col>\n                    <Button color=\"primary\">Submit</Button>\n                    </FormGroup>\n                </Form>\n                <Form onSubmit={saveThat}>\n                    \n                    <Label>Pick and submit a direction</Label>\n                    <br />\n                    <FormGroup row>\n                    <Col sm={10}>\n                    <Input type=\"select\" onChange={whatDirection}>\n                        <option>Pick Direction</option>\n                        {direction.map((direction, index) => {\n                            return <option key={index} >\n                                {direction.Destination}</option>\n                        })};\n                    </Input>\n                    </Col>\n                    <Button color=\"primary\">Submit</Button>\n                    </FormGroup>\n                </Form>\n                <Form onSubmit={saveAlso}>\n                    <Label>Pick your Stop, then...</Label>\n                    <FormGroup row>\n                    <Col sm={10}>\n                    <Input type=\"select\" dangerouslySetInnerHTML={{__html: stops}} onChange={whatStop}>\n                    </Input>\n                    </Col>\n                    </FormGroup>\n                    <Label>What's your number?</Label><br />\n                    <FormGroup row>\n                    <Col sm={10}>\n                    <Input className=\"form-control\" onChange={(e) => setPhoneNumber(e.target.value)} value={phoneNumber}></Input>\n                    </Col>\n                    <Input type='hidden' value={message}></Input>\n                    <Button color=\"primary\">Submit</Button>\n                    </FormGroup>\n                </Form>\n            </div>\n        </div>\n    )\n};"]},"metadata":{},"sourceType":"module"}